<app-home 
  [spaces]="spacesPlantaActual" 
  [modeEditor]="modeEditor" 
  [puntsTemporals]="puntsTemporals"
  [colorMode]="'zone'"
  (plantaChange)="onPlantaSeleccionada($event)" 
  (svgClick)="onSvgClick($event)">

  <div sidebar-bottom class="space-y-4">

    <div class="rounded-lg border border-border bg-card shadow-sm">
      <div class="border-b border-border px-4 py-3">
        <h3 class="text-sm font-semibold text-card-foreground">GestiÃ³ d'Espais</h3>
      </div>
      <div class="divide-y divide-border">
        <button (click)="iniciarCrearSpace()" [class.bg-blue-500]="modeEditor === 'create'"
          [class.text-white]="modeEditor === 'create'"
          class="flex w-full items-center gap-3 px-4 py-3 text-left transition-colors hover:bg-accent disabled:opacity-50 disabled:cursor-not-allowed">
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          <span class="text-sm font-medium">Afegir Espai</span>
        </button>

        <button (click)="iniciarEditarSpace()" [class.bg-yellow-500]="modeEditor === 'edit'"
          [class.text-white]="modeEditor === 'edit'"
          class="flex w-full items-center gap-3 px-4 py-3 text-left transition-colors hover:bg-accent disabled:opacity-50 disabled:cursor-not-allowed">
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
          <span class="text-sm font-medium">Editar Espai</span>
        </button>

        <button (click)="iniciarEliminarSpace()" [class.bg-red-500]="modeEditor === 'delete'"
          [class.text-white]="modeEditor === 'delete'"
          class="flex w-full items-center gap-3 px-4 py-3 text-left transition-colors hover:bg-accent disabled:opacity-50 disabled:cursor-not-allowed">
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
          <span class="text-sm font-medium">Eliminar Espai</span>
        </button>
      </div>

      <div *ngIf="isLoading" class="border-t border-border p-4 flex items-center justify-center">
        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary"></div>
      </div>

      <div *ngIf="modeEditor === 'create' && !isLoading" class="border-t border-border p-4 space-y-3 bg-blue-50">
        <div>
          <label class="text-xs font-medium text-gray-700">Nom de l'espai</label>
          <input [(ngModel)]="nomNouSpace" type="text" placeholder="Ex: Aula 101, Laboratori A..."
            class="w-full mt-1 px-3 py-2 text-sm border border-input rounded-md bg-white" [disabled]="isLoading">
        </div>

        <div>
          <label class="text-xs font-medium text-gray-700">Zona</label>
          <select [(ngModel)]="zoneSeleccionada"
            class="w-full mt-1 px-3 py-2 text-sm border border-input rounded-md bg-white" [disabled]="isLoading">
            <option [ngValue]="null">Selecciona una zona</option>
            <option *ngFor="let zone of zones" [ngValue]="zone.id">
              <span [style.color]="getColorZona(zone.id)"></span> {{ zone.name }}
            </option>
          </select>
        </div>

        <div class="text-xs space-y-1">
          <p class="font-medium text-gray-700">Punts definits: {{ puntsTemporals.length }}</p>
          <p class="text-blue-600">ðŸ’¡ Clica al plÃ nol per afegir punts (mÃ­nim 3)</p>
        </div>

        <div class="flex gap-2">
          <button (click)="finalitzarSpace()"
            [disabled]="puntsTemporals.length < 3 || !nomNouSpace.trim() || !zoneSeleccionada || isLoading"
            class="flex-1 px-3 py-2 text-xs font-medium bg-emerald-500 text-white rounded-md hover:bg-emerald-600 disabled:opacity-50 disabled:cursor-not-allowed">
            âœ“ Guardar Espai
          </button>
          <button (click)="cancelarAccio()" [disabled]="isLoading"
            class="px-3 py-2 text-xs font-medium border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50">
            CancelÂ·lar
          </button>
        </div>
      </div>

      <div *ngIf="modeEditor === 'edit' && !spaceEditant && !isLoading" class="border-t border-border p-4 bg-yellow-50">
        <p class="text-xs text-yellow-700">ðŸ‘† Clica sobre un espai per editar-lo</p>
      </div>

      <div *ngIf="modeEditor === 'edit' && spaceEditant && !isLoading"
        class="border-t border-border p-4 space-y-3 bg-yellow-50">
        <div>
          <label class="text-xs font-medium text-gray-700">Nom de l'espai</label>
          <input [(ngModel)]="nomNouSpace" type="text"
            class="w-full mt-1 px-3 py-2 text-sm border border-input rounded-md bg-white" [disabled]="isLoading">
        </div>

        <div>
          <label class="text-xs font-medium text-gray-700">Zona</label>
          <select [(ngModel)]="zoneSeleccionada"
            class="w-full mt-1 px-3 py-2 text-sm border border-input rounded-md bg-white" [disabled]="isLoading">
            <option [ngValue]="null">Selecciona una zona</option>
            <option *ngFor="let zone of zones" [ngValue]="zone.id">{{ zone.name }}</option>
          </select>
        </div>

        <div class="text-xs space-y-1">
          <p class="font-medium text-gray-700">Punts: {{ puntsTemporals.length }}</p>
          <div class="max-h-32 overflow-y-auto space-y-1 mt-2">
            <div *ngFor="let punt of puntsTemporals; let i = index"
              class="flex items-center justify-between bg-white px-2 py-1 rounded">
              <span class="text-xs">Punt {{ i + 1 }}: ({{ (punt.x * 100).toFixed(1) }}%, {{ (punt.y * 100).toFixed(1)
                }}%)</span>
              <button (click)="eliminarPuntSpaceEdit(i)" [disabled]="isLoading"
                class="text-red-500 hover:text-red-700 disabled:opacity-50">
                <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>
          <p class="text-yellow-600 mt-2">ðŸ’¡ Clica al plÃ nol per afegir mÃ©s punts</p>
        </div>

        <div class="flex gap-2">
          <button (click)="actualitzarSpace()"
            [disabled]="puntsTemporals.length < 3 || !nomNouSpace.trim() || !zoneSeleccionada || isLoading"
            class="flex-1 px-3 py-2 text-xs font-medium bg-yellow-500 text-white rounded-md hover:bg-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed">
            âœ“ Actualitzar
          </button>
          <button (click)="cancelarAccio()" [disabled]="isLoading"
            class="px-3 py-2 text-xs font-medium border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50">
            CancelÂ·lar
          </button>
        </div>
      </div>

      <div *ngIf="modeEditor === 'delete' && !isLoading" class="border-t border-border p-4 bg-red-50">
        <p class="text-xs text-red-700">ðŸ‘† Clica sobre un espai per eliminar-lo</p>
      </div>
    </div>

  </div>

  <!-- Sidebar Dreta: Zones -->
  <div sidebar-right class="space-y-4">

    <div class="rounded-lg border border-border bg-card shadow-sm">
      <div class="border-b border-border px-4 py-3">
        <h3 class="text-sm font-semibold text-card-foreground">Zones</h3>
      </div>
      <div class="divide-y divide-border">
        <button 
          *ngFor="let zone of zones" 
          (click)="filtrarPerZona(zone.id)"
          [class.bg-accent]="zoneSeleccionada === zone.id"
          class="flex w-full items-center gap-3 px-4 py-3 text-left transition-colors hover:bg-accent/50">
          <div 
            [style.background-color]="getColorZona(zone.id)"
            class="h-4 w-4 rounded flex-shrink-0">
          </div>
          <span class="text-sm font-medium">{{ zone.name }}</span>
        </button>
        
        <button 
          (click)="filtrarPerZona(null)"
          [class.bg-primary]="zoneSeleccionada === null"
          [class.text-primary-foreground]="zoneSeleccionada === null"
          class="flex w-full items-center gap-3 px-4 py-3 text-left transition-colors hover:bg-accent">
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <span class="text-sm font-medium">Totes les zones</span>
        </button>
      </div>
    </div>

  </div>

</app-home>